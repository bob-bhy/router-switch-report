<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>欧区新客户多维度分析看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-treemap@2.3.0/dist/chartjs-chart-treemap.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Helvetica Neue', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', 'Microsoft YaHei', sans-serif;
            background-color: #030712; /* Darker background */
            color: #F9FAFB;
        }
        .chart-wrapper {
            background-color: #1F2937;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .table-container::-webkit-scrollbar { width: 8px; height: 8px; }
        .table-container::-webkit-scrollbar-track { background: #1F2937; }
        .table-container::-webkit-scrollbar-thumb { background-color: #4B5563; border-radius: 10px; border: 2px solid #1F2937; }
    </style>
</head>
<body class="bg-gray-900">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">欧区新客户数据分析看板</h1>
            <p class="text-gray-400 mt-2">（V5修正版 - 数据源: PDF）</p>
        </header>

        <!-- Section for Charts -->
        <div class="space-y-8">
            <div class="chart-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-center">年度新增客户总数趋势</h2>
                <div class="relative h-72">
                    <canvas id="yearlyTrendChart"></canvas>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-center">核心市场年度趋势 (Top 5 国家)</h2>
                <div class="relative h-96">
                    <canvas id="top5TrendChart"></canvas>
                </div>
            </div>

            <div class="chart-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-center">各区域年度新增客户对比 (绝对数量)</h2>
                 <div class="relative h-96">
                    <canvas id="regionalYearlyChart"></canvas>
                </div>
            </div>
             
            <div class="chart-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-center">区域获客贡献度变化 (百分比)</h2>
                 <div class="relative h-96">
                    <canvas id="regionalPercentageChart"></canvas>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="chart-wrapper">
                    <h2 class="text-xl font-semibold mb-4 text-center">绝对数量变化榜 (2023 vs 2024)</h2>
                     <div class="relative h-[450px]">
                        <canvas id="absChangeChart"></canvas>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <h2 class="text-xl font-semibold mb-4 text-center">年度增长率排行榜 (2023 vs 2024)</h2>
                     <div class="relative h-[450px]">
                        <canvas id="rateChangeChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="chart-wrapper">
                <h2 class="text-xl font-semibold mb-4 text-center">各国总新增客户数贡献 (Top 30)</h2>
                 <div class="relative h-96">
                    <canvas id="treemapChart"></canvas>
                </div>
            </div>

            <div class="chart-wrapper">
                 <h2 class="text-xl font-semibold mb-4 text-center">新增客户数据详情</h2>
                <div class="table-container overflow-y-auto h-96">
                    <table class="w-full text-left">
                        <thead class="sticky top-0 bg-gray-700 z-10">
                            <tr>
                                <th class="p-3">排名</th>
                                <th class="p-3">国家/地区</th>
                                <th class="p-3">2023</th>
                                <th class="p-3">2024</th>
                                <th class="p-3">2025</th>
                                <th class="p-3">合计</th>
                            </tr>
                        </thead>
                        <tbody id="data-table">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Data manually transcribed from the provided PDF to ensure 100% accuracy.
    const pdfData = [
        { country: '阿联酋', y2023: 454, y2024: 297, y2025: 205, total: 956 },
        { country: '沙特阿拉伯', y2023: 439, y2024: 238, y2025: 194, total: 871 },
        { country: '英国', y2023: 220, y2024: 98, y2025: 81, total: 399 },
        { country: '法国', y2023: 156, y2024: 73, y2025: 49, total: 278 },
        { country: '土耳其', y2023: 92, y2024: 57, y2025: 47, total: 196 },
        { country: '伊拉克', y2023: 78, y2024: 57, y2025: 37, total: 172 },
        { country: '德国', y2023: 85, y2024: 45, y2025: 39, total: 169 },
        { country: '意大利', y2023: 78, y2024: 43, y2025: 41, total: 162 },
        { country: '阿曼', y2023: 50, y2024: 47, y2025: 47, total: 144 },
        { country: '西班牙', y2023: 67, y2024: 37, y2025: 39, total: 143 },
        { country: '卡塔尔', y2023: 55, y2024: 39, y2025: 32, total: 126 },
        { country: '科威特', y2023: 40, y2024: 36, y2025: 20, total: 96 },
        { country: '波兰', y2023: 43, y2024: 31, y2025: 21, total: 95 },
        { country: '哈萨克斯坦', y2023: 41, y2024: 32, y2025: 18, total: 91 },
        { country: '荷兰', y2023: 44, y2024: 28, y2025: 14, total: 86 },
        { country: '以色列', y2023: 30, y2024: 35, y2025: 17, total: 82 },
        { country: '约旦', y2023: 27, y2024: 24, y2025: 20, total: 71 },
        { country: '阿塞拜疆', y2023: 28, y2024: 18, y2025: 21, total: 67 },
        { country: '罗马尼亚', y2023: 30, y2024: 20, y2025: 15, total: 65 },
        { country: '希腊', y2023: 22, y2024: 23, y2025: 17, total: 62 },
        { country: '乌克兰', y2023: 26, y2024: 20, y2025: 15, total: 61 },
        { country: '乌兹别克斯坦', y2023: 20, y2024: 36, y2025: 2, total: 58 },
        { country: '捷克共和国', y2023: 29, y2024: 11, y2025: 17, total: 57 },
        { country: '瑞士', y2023: 25, y2024: 18, y2025: 12, total: 55 },
        { country: '葡萄牙', y2023: 26, y2024: 18, y2025: 10, total: 54 },
        { country: '比利时', y2023: 25, y2024: 14, y2025: 12, total: 51 },
        { country: '黎巴嫩', y2023: 22, y2024: 12, y2025: 11, total: 45 },
        { country: '保加利亚', y2023: 12, y2024: 15, y2025: 14, total: 41 },
        { country: '匈牙利', y2023: 18, y2024: 11, y2025: 7, total: 36 },
        { country: '阿尔巴尼亚', y2023: 22, y2024: 10, y2025: 3, total: 35 },
        { country: '奥地利', y2023: 8, y2024: 14, y2025: 11, total: 33 },
        { country: '爱尔兰', y2023: 18, y2024: 8, y2025: 6, total: 32 },
        { country: '塞浦路斯', y2023: 11, y2024: 13, y2025: 8, total: 32 },
        { country: '克罗地亚', y2023: 12, y2024: 8, y2025: 10, total: 30 },
        { country: '丹麦', y2023: 12, y2024: 6, y2025: 10, total: 28 },
        { country: '瑞典', y2023: 14, y2024: 10, y2025: 3, total: 27 },
        { country: '斯洛伐克', y2023: 12, y2024: 8, y2025: 6, total: 26 },
        { country: '吉尔吉斯斯坦', y2023: 12, y2024: 9, y2025: 4, total: 25 },
        { country: '立陶宛', y2023: 13, y2024: 5, y2025: 5, total: 23 },
        { country: '挪威', y2023: 10, y2024: 3, y2025: 6, total: 19 },
        { country: '马耳他', y2023: 7, y2024: 5, y2025: 6, total: 18 },
        { country: '拉脱维亚', y2023: 6, y2024: 6, y2025: 5, total: 17 },
        { country: '爱沙尼亚', y2023: 8, y2024: 4, y2025: 4, total: 16 },
        { country: '芬兰', y2023: 9, y2024: 3, y2025: 2, total: 14 },
        { country: '格鲁吉亚', y2023: 6, y2024: 6, y2025: 1, total: 13 },
        { country: '塞尔维亚', y2023: 4, y2024: 5, y2025: 2, total: 11 },
        { country: '摩尔多瓦', y2023: 5, y2024: 4, y2025: 2, total: 11 },
        { country: '塔吉克斯坦', y2023: 6, y2024: 3, y2025: 2, total: 11 },
        { country: '白俄罗斯', y2023: 8, y2024: 2, y2025: 0, total: 10 },
        { country: '科索沃', y2023: 0, y2024: 5, y2025: 5, total: 10 },
        { country: '也门(Yemen)', y2023: 2, y2024: 4, y2025: 4, total: 10 },
        { country: '北马其顿', y2023: 3, y2024: 3, y2025: 3, total: 9 },
        { country: '巴勒斯坦', y2023: 5, y2024: 3, y2025: 0, total: 8 },
        { country: '波斯尼亚和黑塞哥维那', y2023: 3, y2024: 2, y2025: 3, total: 8 },
        { country: '卢森堡', y2023: 4, y2024: 3, y2025: 1, total: 8 },
        { country: '斯洛文尼亚', y2023: 4, y2024: 2, y2025: 2, total: 8 },
        { country: '黑山', y2023: 4, y2024: 0, y2025: 2, total: 6 },
        { country: '亚美尼亚', y2023: 1, y2024: 3, y2025: 2, total: 6 },
        { country: '叙利亚', y2023: 2, y2024: 1, y2025: 2, total: 5 },
        { country: '冰岛', y2023: 2, y2024: 1, y2025: 1, total: 4 },
        { country: '安道尔', y2023: 3, y2024: 0, y2025: 0, total: 3 },
        { country: '土库曼斯坦', y2023: 2, y2024: 0, y2025: 0, total: 2 },
        { country: '阿富汗', y2023: 0, y2024: 0, y2025: 1, total: 1 },
        { country: '格恩西岛', y2023: 0, y2024: 0, y2025: 1, total: 1 },
        { country: '列支敦士登', y2023: 1, y2024: 0, y2025: 0, total: 1 },
        { country: '马恩岛', y2023: 0, y2024: 0, y2025: 1, total: 1 },
        // These countries were in the CSV but not clearly visible in the PDF, so data might be incomplete or zero.
        // For accuracy, only including data explicitly transcribed from the PDF.
    ];

    const data = pdfData;
    data.sort((a, b) => b.total - a.total);


    // --- 2. Region Mapping and Aggregation ---
    const regionMap = {
        '中东': ['阿联酋', '阿曼', '巴林', '卡塔尔', '科威特', '黎巴嫩', '沙特阿拉伯', '也门(Yemen)', '伊拉克', '以色列', '约旦', '巴勒斯坦', '伊朗', '叙利亚', '土耳其'],
        '中亚': ['阿塞拜疆', '哈萨克斯坦', '吉尔吉斯斯坦', '塔吉克斯坦', '土库曼斯坦', '乌兹别克斯坦', '亚美尼亚', '格鲁吉亚', '阿富汗'],
        '东欧': ['白俄罗斯', '保加利亚', '捷克共和国', '匈牙利', '摩尔多瓦', '波兰', '罗马尼亚', '乌克兰', '俄罗斯', '斯洛伐克', '科索沃'],
        '西欧': ['奥地利', '法国', '德国', '荷兰', '瑞士', '英国', '比利时', '列支敦士登', '卢森堡', '格恩西岛', '马恩岛'],
        '北欧': ['爱尔兰', '爱沙尼亚', '丹麦', '芬兰', '冰岛', '拉脱维亚', '立陶宛', '挪威', '瑞典'],
        '南欧': ['阿尔巴尼亚', '安道尔', '克罗地亚', '塞浦路斯', '希腊', '意大利', '马耳他', '葡萄牙', '塞尔维亚', '斯洛文尼亚', '西班牙', '北马其顿', '波斯尼亚和黑塞哥维那', '黑山'],
    };
    const getRegion = (country) => {
        for (const region in regionMap) {
            if (regionMap[region].includes(country)) return region;
        }
        return '其他';
    };
    data.forEach(item => item.region = getRegion(item.country));
    
    // --- 3. Chart Rendering ---
    const chartColors = {
        grid: 'rgba(255, 255, 255, 0.1)',
        text: '#F9FAFB',
        line: 'rgba(59, 130, 246, 0.8)',
        regions: ['#3B82F6', '#EF4444', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899', '#6B7280'],
        top5: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'],
        growth: 'rgba(16, 185, 129, 0.7)',
        decline: 'rgba(239, 68, 68, 0.7)'
    };
    Chart.defaults.color = chartColors.text;
    Chart.defaults.borderColor = chartColors.grid;
    
    const years = ['2023', '2024', '2025'];
    
    // Chart 1: Yearly Trend
    const yearlyTotals = {
        '2023': data.reduce((sum, d) => sum + d.y2023, 0),
        '2024': data.reduce((sum, d) => sum + d.y2024, 0),
        '2025': data.reduce((sum, d) => sum + d.y2025, 0),
    };
    new Chart('yearlyTrendChart', {
        type: 'line',
        data: {
            labels: years,
            datasets: [{
                label: '新增客户总数',
                data: Object.values(yearlyTotals),
                borderColor: chartColors.line,
                backgroundColor: chartColors.line.replace('0.8', '0.2'),
                fill: true,
                tension: 0.1
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // Chart 2: Top 5 Countries Trend
    const top5Data = data.slice(0, 5);
    new Chart('top5TrendChart', {
        type: 'line',
        data: {
            labels: years,
            datasets: top5Data.map((d, i) => ({
                label: d.country,
                data: [d.y2023, d.y2024, d.y2025],
                borderColor: chartColors.top5[i],
                backgroundColor: 'transparent',
                tension: 0.1
            }))
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        }
    });


    const regions = [...new Set(data.map(d => d.region))];

    // Chart 3: Regional Yearly Stacked Bar (Absolute)
    const regionalAbsoluteData = {
        labels: years,
        datasets: regions.map((region, i) => ({
            label: region,
            data: years.map(year => 
                data.filter(d => d.region === region).reduce((s, c) => s + c[`y${year}`], 0)
            ),
            backgroundColor: chartColors.regions[i % chartColors.regions.length],
        }))
    };
    new Chart('regionalYearlyChart', {
        type: 'bar',
        data: regionalAbsoluteData,
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: { x: { stacked: true }, y: { stacked: true, title: { display: true, text: '客户数量' } } },
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // Chart 4: Regional Yearly Stacked Bar (Percentage)
    const regionalPercentageData = {
        labels: years,
        datasets: regions.map((region, i) => ({
            label: region,
            data: years.map(year => {
                const regionTotal = data.filter(d => d.region === region).reduce((s, c) => s + c[`y${year}`], 0);
                return yearlyTotals[year] > 0 ? (regionTotal / yearlyTotals[year]) * 100 : 0;
            }),
            backgroundColor: chartColors.regions[i % chartColors.regions.length],
        }))
    };
    new Chart('regionalPercentageChart', {
        type: 'bar',
        data: regionalPercentageData,
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: { 
                x: { stacked: true }, 
                y: { stacked: true, max: 100, title: { display: true, text: '贡献度 (%)' } } 
            },
            plugins: { 
                legend: { position: 'bottom' },
                tooltip: { callbacks: { label: (context) => `${context.dataset.label}: ${context.raw.toFixed(2)}%` } }
            }
        }
    });


    // Chart 5 & 6: Change Charts
    const absChanges = data.map(d => ({ country: d.country, change: d.y2024 - d.y2023 })).filter(d => d.change !== 0);
    absChanges.sort((a, b) => Math.abs(b.change) - Math.abs(a.change));
    const top15AbsMovers = absChanges.slice(0, 15).sort((a,b) => b.change - a.change);

    new Chart('absChangeChart', {
        type: 'bar',
        data: {
            labels: top15AbsMovers.map(d => d.country),
            datasets: [{
                label: '数量变化',
                data: top15AbsMovers.map(d => d.change),
                backgroundColor: top15AbsMovers.map(d => d.change >= 0 ? chartColors.growth : chartColors.decline)
            }]
        },
        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });
    
    const rateChanges = data.filter(d => d.y2023 > 5).map(d => ({ // Only show for countries with a meaningful base
        country: d.country, 
        change: ((d.y2024 - d.y2023) / d.y2023) * 100 
    }));
    rateChanges.sort((a, b) => Math.abs(b.change) - Math.abs(a.change));
    const top15RateMovers = rateChanges.slice(0, 15).sort((a,b) => b.change - a.change);

    new Chart('rateChangeChart', {
        type: 'bar',
        data: {
            labels: top15RateMovers.map(d => d.country),
            datasets: [{
                label: '增长率',
                data: top15RateMovers.map(d => d.change),
                backgroundColor: top15RateMovers.map(d => d.change >= 0 ? chartColors.growth : chartColors.decline)
            }]
        },
        options: { 
            indexAxis: 'y', responsive: true, maintainAspectRatio: false, 
            plugins: { 
                legend: { display: false },
                tooltip: { callbacks: { label: (context) => `${context.label}: ${context.raw.toFixed(2)}%` } }
            },
            scales: { x: { ticks: { callback: (value) => `${value.toFixed(0)}%` } } }
        }
    });


    // Chart 7: Treemap (Optimized)
    const treemapData = data.slice(0, 30);
    const otherTotal = data.slice(30).reduce((sum, d) => sum + d.total, 0);
    if (otherTotal > 0) {
        treemapData.push({ country: '其他', total: otherTotal });
    }
    
    new Chart('treemapChart', {
        type: 'treemap',
        data: {
            datasets: [{
                tree: treemapData,
                key: 'total',
                groups: ['country'],
                backgroundColor: (ctx) => {
                     if (!ctx.raw || typeof ctx.raw.v === 'undefined') {
                        return 'rgba(75, 85, 99, 0.5)';
                    }
                    const max = treemapData[0].total;
                    const alpha = Math.min((ctx.raw.v / max) * 1.5, 1);
                    return `rgba(59, 130, 246, ${alpha})`;
                },
                labels: { display: true, formatter: (ctx) => ctx.raw.g }
            }],
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
    });
    
    // Table
    const tableBody = document.getElementById('data-table');
    tableBody.innerHTML = '';
    data.forEach((item, index) => {
        const row = document.createElement('tr');
        row.className = 'border-b border-gray-700 hover:bg-gray-600';
        row.innerHTML = `
            <td class="p-3">${index + 1}</td>
            <td class="p-3">${item.country}</td>
            <td class="p-3">${item.y2023}</td>
            <td class="p-3">${item.y2024}</td>
            <td class="p-3">${item.y2025}</td>
            <td class="p-3 font-bold">${item.total}</td>
        `;
        tableBody.appendChild(row);
    });
});
</script>

</body>
</html>

